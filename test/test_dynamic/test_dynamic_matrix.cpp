#include "test_dynamic_matrix.h"
#include <iostream>
#include <aris.h>

using namespace aris::dynamic;

const double error = 1e-10;


void test_basic_operation()
{
	//test isEqual
	{
		double a[] = { 0.1,0.2,0.3 };
		double b[] = { 0.1,0.2,0.3 };
		double c[] = { 0.1,0.2,0.35 };

		if (!s_is_equal(3, a, b, error))std::cout << "\"s_is_equal\" failed" << std::endl;
		if (s_is_equal(3, a, c, error))std::cout << "\"s_is_equal\" failed" << std::endl;

		double d[]{ 0.1,0.2,0.3,0.4,0.5,0.6 };
		double e[]{ 0.1,0.0,0.2,0.3,0.0,0.4,0.5,0.0,0.6 };
		if (!s_is_equal(3, d, 2, e, 3, error))std::cout << "\"s_is_equal\" failed" << std::endl;
		if (s_is_equal(3, d, 2, e + 1, 3, error))std::cout << "\"s_is_equal\" failed" << std::endl;

		double m1[]{ 0.1,0.2,0.3,
			0.4,0.5,0.6 };
		double m2[]{ 0.1,0.2,0.3,
			0.4,0.5,0.6 };
		double m3[]{ 0.1,0.2,0.31,
			0.4,0.5,0.6 };

		if (!s_is_equal(2, 3, m1, m2, error))std::cout << "\"s_is_equal mtx\" failed" << std::endl;
		if (s_is_equal(2, 3, m1, m3, error))std::cout << "\"s_is_equal mtx\" failed" << std::endl; 
		
		double m4[]{ 0.1,0.2,0.3,0.0,
			0.4,0.5,0.6,0.0 };
		double m5[]{ 0.1,0.2,0.3,0.0,0.0,
			0.4,0.5,0.6,0.0,0.0, };
		double m6[]{ 0.1,0.2,0.3,0.0,0.0,
			0.4,0.51,0.6,0.0,0.0, };

		if (!s_is_equal(2, 3, m4, 4, m5, 5, error))std::cout << "\"s_is_equal mtx\" failed" << std::endl;
		if (s_is_equal(2, 3, m4, 4, m6, 5, error))std::cout << "\"s_is_equal mtx\" failed" << std::endl;
	}

}
void test_multiply()
{
	const double alpha{ 0.255095115459269 };
	const double v[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double v_ld[]{ 0.498364051982143,0,0,0.959743958516081,0,0,0.340385726666133,0,0,0.585267750979777,0,0,0.223811939491137,0,0,0.751267059305653,0,0 };
	const double r1[]{ 0.127130235381134,0.244825995908996,0.0868307362445845,0.149298944510773,0.0570933325456545,0.191644557234321 };
	const double r1_ld[]{ 0.127130235381134,0,0,0.244825995908996,0,0,0.0868307362445845,0,0,0.149298944510773,0,0,0.0570933325456545,0,0,0.191644557234321,0,0 };
	const double r2[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double r2_ld[]{ 0.498364051982143,0,0.959743958516081,0,0.340385726666133,0,0.585267750979777,0,0.223811939491137,0,0.751267059305653,0 };
	const double r3[]{ 0.127130235381134,0.244825995908996,0.0868307362445845,0.149298944510773,0.0570933325456545,0.191644557234321 };
	const double r3_ld[]{ 0.127130235381134,0,0.244825995908996,0,0.0868307362445845,0,0.149298944510773,0,0.0570933325456545,0,0.191644557234321,0 };
	const double r4[]{ 1.00432110364729,1.65882068117277,1.23128897920193,1.54455917618522,0.77102746945494,0.889891502134332 };
	double r4_before[]{ 0.505957051665142,0.699076722656686,0.890903252535799,0.959291425205444,0.547215529963803,0.138624442828679 };
	const double r4_ld[]{ 1.00432110364729,0,1.65882068117277,0,1.23128897920193,0,1.54455917618522,0,0.77102746945494,0,0.889891502134332,0 };
	double r4_ld_before[]{ 0.505957051665142,0,0.699076722656686,0,0.890903252535799,0,0.959291425205444,0,0.547215529963803,0,0.138624442828679,0 };
	const double r5[]{ 0.633087287046276,0.943902718565682,0.977733988780383,1.10859036971622,0.604308862509458,0.330269000063 };
	double r5_before[]{ 0.505957051665142,0.699076722656686,0.890903252535799,0.959291425205444,0.547215529963803,0.138624442828679 };
	const double r5_ld[]{ 0.633087287046276,0,0.943902718565682,0,0.977733988780383,0,1.10859036971622,0,0.604308862509458,0,0.330269000063,0 };
	double r5_ld_before[]{ 0.505957051665142,0,0.699076722656686,0,0.890903252535799,0,0.959291425205444,0,0.547215529963803,0,0.138624442828679,0 };

	const double v1[]{ 0.1,0.23,0.45,0.67,0.89 };
	const double v2[]{ -0.1,0.89,-0.45,0.67,0.12 };
	const double v1_ld[]{ 0.1,0,0.23,0,0.45,0,0.67,0,0.89,0 };
	const double v2_ld[]{ -0.1,0,0,0.89,0,0,-0.45,0,0,0.67,0,0,0.12,0,0 };
	double vv_result{ 0.5479 };


	double result[36];

	std::copy(v, v + 6, result);
	s_nv(6, alpha, result);
	if (!s_is_equal(6, result, r1, error))std::cout << "\"s_nv\" failed" << std::endl;

	std::copy(v_ld, v_ld + 18, result);
	s_nv(6, alpha, result, 3);
	if (!s_is_equal(18, result, r1_ld, error))std::cout << "\"s_nv with ld\" failed" << std::endl;

	std::fill(result, result + 36, 1.0);
	s_vc(6, v, result);
	if (!s_is_equal(6, result, r2, error))std::cout << "\"s_vc\" failed" << std::endl;

	std::fill(result, result + 36, 0);
	s_vc(6, v_ld, 3, result, 2);
	if (!s_is_equal(12, result, r2_ld, error))std::cout << "\"s_vc with ld\" failed" << std::endl;

	std::fill(result, result + 36, 1.0);
	s_vc(6, alpha, v, result);
	if (!s_is_equal(6, result, r3, error))std::cout << "\"s_vc\" failed" << std::endl;

	std::fill(result, result + 36, 0);
	s_vc(6, alpha, v_ld, 3, result, 2);
	if (!s_is_equal(12, result, r3_ld, error))std::cout << "\"s_vc with ld\" failed" << std::endl;

	s_va(6, v, r4_before);
	if (!s_is_equal(6, r4_before, r4, error))std::cout << "\"s_va\" failed" << std::endl;

	s_va(6, v_ld, 3, r4_ld_before, 2);
	if (!s_is_equal(12, r4_ld_before, r4_ld, error))std::cout << "\"s_va with ld\" failed" << std::endl;

	s_va(6, alpha, v, r5_before);
	if (!s_is_equal(6, r5_before, r5, error))std::cout << "\"s_va\" failed" << std::endl;

	s_va(6, alpha, v_ld, 3, r5_ld_before, 2);
	if (!s_is_equal(12, r5_ld_before, r5_ld, error))std::cout << "\"s_va with ld\" failed" << std::endl;

	result[0] = s_vv(5, v1, v2);
	if (!s_is_equal(1, result, &vv_result, error))std::cout << "\"s_vv\" failed" << std::endl;

	result[0] = s_vv(5, v1_ld, 2, v2_ld, 3);
	if (!s_is_equal(1, result, &vv_result, error))std::cout << "\"s_vv with ld\" failed" << std::endl;


	const double m1[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double o1[]{ 0.127130235381134,0.244825995908996,0.0868307362445845,0.149298944510773,0.0570933325456545,0.191644557234321 };
	const double m2[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0,0 };
	const double o2[]{ 0.127130235381134,0.244825995908996,0.0868307362445845,0,0,0,0.149298944510773,0.0570933325456545,0.191644557234321,0,0,0 };

	const double m2_ld[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0 };
	const double m1T[]{ 0.498364051982143,0.585267750979777,0.959743958516081,0.223811939491137,0.340385726666133,0.751267059305653 };
	const double m2T_ld[]{ 0.498364051982143,0.585267750979777,0,0,0,0.959743958516081,0.223811939491137,0,0,0,0.340385726666133,0.751267059305653,0,0,0 };

	const double m3[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double o3[]{ 1.00432110364729,1.65882068117277,1.23128897920193,1.54455917618522,0.77102746945494,0.889891502134332 };
	double o3_before[]{ 0.505957051665142,0.699076722656686,0.890903252535799,0.959291425205444,0.547215529963803,0.138624442828679 };
	const double m4[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0 };
	const double o4[]{ 1.00432110364729,1.65882068117277,1.23128897920193,0,1.54455917618522,0.77102746945494,0.889891502134332,0 };
	double o4_before[]{ 0.505957051665142,0.699076722656686,0.890903252535799,0,0.959291425205444,0.547215529963803,0.138624442828679,0 };
	const double m5[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double o5[]{ 0.633087287046276,0.943902718565682,0.977733988780383,1.10859036971622,0.604308862509458,0.330269000063 };
	double o5_before[]{ 0.505957051665142,0.699076722656686,0.890903252535799,0.959291425205444,0.547215529963803,0.138624442828679 };
	const double m6[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0 };
	const double o6[]{ 0.633087287046276,0.943902718565682,0.977733988780383,0,1.10859036971622,0.604308862509458,0.330269000063,0 };
	double o6_before[]{ 0.505957051665142,0.699076722656686,0.890903252535799,0,0.959291425205444,0.547215529963803,0.138624442828679,0 };

	const double m3T[]{ 0.498364051982143,0.585267750979777,0.959743958516081,0.223811939491137,0.340385726666133,0.751267059305653 };
	double o3T_before[]{ 0.505957051665142,0.699076722656686,0.890903252535799,0.959291425205444,0.547215529963803,0.138624442828679 };
	const double m4T[]{ 0.498364051982143,0.585267750979777,0,0,0,0.959743958516081,0.223811939491137,0,0,0,0.340385726666133,0.751267059305653,0,0,0 };
	double o4T_before[]{ 0.505957051665142,0.699076722656686,0.890903252535799,0,0.959291425205444,0.547215529963803,0.138624442828679,0 };
	const double m5T[]{ 0.498364051982143,0.585267750979777,0.959743958516081,0.223811939491137,0.340385726666133,0.751267059305653 };
	double o5T_before[]{ 0.505957051665142,0.699076722656686,0.890903252535799,0.959291425205444,0.547215529963803,0.138624442828679 };
	const double m6T[]{ 0.498364051982143,0.585267750979777,0,0,0,0.959743958516081,0.223811939491137,0,0,0,0.340385726666133,0.751267059305653,0,0,0 };
	double o6T_before[]{ 0.505957051665142,0.699076722656686,0.890903252535799,0,0.959291425205444,0.547215529963803,0.138624442828679,0 };

	const double m7a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double m7b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616 };
	const double o7[]{ 1.31858183661872,1.09529802045975,0.989581394872564,0.962509892352645,0.774959561865027,0.749377875701963,1.0047379842151,1.32916821737827 };
	const double m8a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0,0 };
	const double m8b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0,0,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0,0,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616,0,0 };
	const double o8[]{ 1.31858183661872,1.09529802045975,0.989581394872564,0.962509892352645,0,0.774959561865027,0.749377875701963,1.0047379842151,1.32916821737827,0 };
	const double m9a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double m9b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616 };
	const double o9[]{ 0.336363785854748,0.27940517499149,0.252437380181361,0.245531572120387,0.197688398910224,0.191162635724814,0.256303752089665,0.339064319876901 };
	const double m10a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0,0 };
	const double m10b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0,0,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0,0,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616,0,0 };
	const double o10[]{ 0.336363785854748,0.27940517499149,0.252437380181361,0.245531572120387,0,0.197688398910224,0.191162635724814,0.256303752089665,0.339064319876901,0 };

	const double m11a[]{ 0.498364051982143,0.585267750979777,0.959743958516081,0.223811939491137,0.340385726666133,0.751267059305653 };
	const double m11b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616 };
	const double o11[]{ 1.31858183661872,1.09529802045975,0.989581394872564,0.962509892352645,0.774959561865027,0.749377875701963,1.0047379842151,1.32916821737827 };
	const double m12a[]{ 0.498364051982143,0.585267750979777,0,0,0,0.959743958516081,0.223811939491137,0,0,0,0.340385726666133,0.751267059305653,0,0,0 };
	const double m12b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0,0,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0,0,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616,0,0 };
	const double o12[]{ 1.31858183661872,1.09529802045975,0.989581394872564,0.962509892352645,0,0.774959561865027,0.749377875701963,1.0047379842151,1.32916821737827,0 };
	const double m13a[]{ 0.498364051982143,0.585267750979777,0.959743958516081,0.223811939491137,0.340385726666133,0.751267059305653 };
	const double m13b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616 };
	const double o13[]{ 0.336363785854748,0.27940517499149,0.252437380181361,0.245531572120387,0.197688398910224,0.191162635724814,0.256303752089665,0.339064319876901 };
	const double m14a[]{ 0.498364051982143,0.585267750979777,0,0,0,0.959743958516081,0.223811939491137,0,0,0,0.340385726666133,0.751267059305653,0,0,0 };
	const double m14b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0,0,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0,0,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616,0,0 };
	const double o14[]{ 0.336363785854748,0.27940517499149,0.252437380181361,0.245531572120387,0,0.197688398910224,0.191162635724814,0.256303752089665,0.339064319876901,0 };

	const double m15a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double m15b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0.913375856139019,0.63235924622541,0.0975404049994095,0.278498218867048,0.546881519204984,0.957506835434298,0.964888535199277,0.157613081677548,0.970592781760616 };
	const double o15[]{ 1.31858183661872,1.09529802045975,0.989581394872564,0.962509892352645,0.774959561865027,0.749377875701963,1.0047379842151,1.32916821737827 };
	const double m16a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0,0 };
	const double m16b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0,0,0.913375856139019,0.63235924622541,0.0975404049994095,0,0,0.278498218867048,0.546881519204984,0.957506835434298,0,0,0.964888535199277,0.157613081677548,0.970592781760616,0,0 };
	const double o16[]{ 1.31858183661872,1.09529802045975,0.989581394872564,0.962509892352645,0,0.774959561865027,0.749377875701963,1.0047379842151,1.32916821737827,0 };
	const double m17a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double m17b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0.913375856139019,0.63235924622541,0.0975404049994095,0.278498218867048,0.546881519204984,0.957506835434298,0.964888535199277,0.157613081677548,0.970592781760616 };
	const double o17[]{ 0.336363785854748,0.27940517499149,0.252437380181361,0.245531572120387,0.197688398910224,0.191162635724814,0.256303752089665,0.339064319876901 };
	const double m18a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0,0 };
	const double m18b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0,0,0.913375856139019,0.63235924622541,0.0975404049994095,0,0,0.278498218867048,0.546881519204984,0.957506835434298,0,0,0.964888535199277,0.157613081677548,0.970592781760616,0,0 };
	const double o18[]{ 0.336363785854748,0.27940517499149,0.252437380181361,0.245531572120387,0,0.197688398910224,0.191162635724814,0.256303752089665,0.339064319876901,0 };

	const double m19a[]{ 0.498364051982143,0.585267750979777,0.959743958516081,0.223811939491137,0.340385726666133,0.751267059305653 };
	const double m19b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0.913375856139019,0.63235924622541,0.0975404049994095,0.278498218867048,0.546881519204984,0.957506835434298,0.964888535199277,0.157613081677548,0.970592781760616 };
	const double o19[]{ 1.31858183661872,1.09529802045975,0.989581394872564,0.962509892352645,0.774959561865027,0.749377875701963,1.0047379842151,1.32916821737827 };
	const double m20a[]{ 0.498364051982143,0.585267750979777,0,0,0,0.959743958516081,0.223811939491137,0,0,0,0.340385726666133,0.751267059305653,0,0,0 };
	const double m20b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0,0,0.913375856139019,0.63235924622541,0.0975404049994095,0,0,0.278498218867048,0.546881519204984,0.957506835434298,0,0,0.964888535199277,0.157613081677548,0.970592781760616,0,0 };
	const double o20[]{ 1.31858183661872,1.09529802045975,0.989581394872564,0.962509892352645,0,0.774959561865027,0.749377875701963,1.0047379842151,1.32916821737827,0 };
	const double m21a[]{ 0.498364051982143,0.585267750979777,0.959743958516081,0.223811939491137,0.340385726666133,0.751267059305653 };
	const double m21b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0.913375856139019,0.63235924622541,0.0975404049994095,0.278498218867048,0.546881519204984,0.957506835434298,0.964888535199277,0.157613081677548,0.970592781760616 };
	const double o21[]{ 0.336363785854748,0.27940517499149,0.252437380181361,0.245531572120387,0.197688398910224,0.191162635724814,0.256303752089665,0.339064319876901 };
	const double m22a[]{ 0.498364051982143,0.585267750979777,0,0,0,0.959743958516081,0.223811939491137,0,0,0,0.340385726666133,0.751267059305653,0,0,0 };
	const double m22b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0,0,0.913375856139019,0.63235924622541,0.0975404049994095,0,0,0.278498218867048,0.546881519204984,0.957506835434298,0,0,0.964888535199277,0.157613081677548,0.970592781760616,0,0 };
	const double o22[]{ 0.336363785854748,0.27940517499149,0.252437380181361,0.245531572120387,0,0.197688398910224,0.191162635724814,0.256303752089665,0.339064319876901,0 };


	std::copy(m1, m1 + 6, result);
	s_nm(2, 3, alpha, result);
	if (!s_is_equal(6, result, o1, error))std::cout << "\"s_nm\" failed" << std::endl;

	std::copy(m2, m2 + 12, result);
	s_nm(2, 3, alpha, result, 6);
	if (!s_is_equal(12, result, o2, error))std::cout << "\"s_nm with ld\" failed" << std::endl;

	s_mc(2, 3, m1, result);
	if (!s_is_equal(6, result, m1, error))std::cout << "\"s_mc\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mc(2, 3, m2_ld, 5, result, 6);
	if (!s_is_equal(12, result, m2, error))std::cout << "\"s_mc with ld\" failed" << std::endl;

	s_mc(2, 3, alpha, m1, result);
	if (!s_is_equal(6, result, o1, error))std::cout << "\"s_mc\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mc(2, 3, alpha, m2_ld, 5, result, 6);
	if (!s_is_equal(12, result, o2, error))std::cout << "\"s_mc with ld\" failed" << std::endl;

	s_mc(2, 3, m1T, ColMajor{2}, result, 3);
	if (!s_is_equal(6, result, m1, error))std::cout << "\"s_mcT\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mc(2, 3, m2T_ld, ColMajor{ 5 }, result, 6);
	if (!s_is_equal(12, result, m2, error))std::cout << "\"s_mcT with ld\" failed" << std::endl;

	s_mc(2, 3, alpha, m1T, ColMajor{ 2 }, result, 3);
	if (!s_is_equal(6, result, o1, error))std::cout << "\"s_mcT\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mc(2, 3, alpha, m2T_ld, ColMajor{ 5 }, result, 6);
	if (!s_is_equal(12, result, o2, error))std::cout << "\"s_mcT with ld\" failed" << std::endl;

	s_ma(2, 3, m3, o3_before);
	if (!s_is_equal(6, o3, o3_before, error))std::cout << "\"s_ma\" failed" << std::endl;

	s_ma(2, 3, m4, 5, o4_before, 4);
	if (!s_is_equal(8, o4, o4_before, error))std::cout << "\"s_ma with ld\" failed" << std::endl;

	s_ma(2, 3, alpha, m5, o5_before);
	if (!s_is_equal(6, o5, o5_before, error))std::cout << "\"s_ma\" failed" << std::endl;

	s_ma(2, 3, alpha, m6, 5, o6_before, 4);
	if (!s_is_equal(8, o6, o6_before, error))std::cout << "\"s_ma with ld\" failed" << std::endl;

	s_ma(2, 3, m3T, ColMajor{2}, o3T_before, 3);
	if (!s_is_equal(6, o3, o3T_before, error))std::cout << "\"s_maT\" failed" << std::endl;

	s_ma(2, 3, m4T, ColMajor{ 5 }, o4T_before, 4);
	if (!s_is_equal(8, o4, o4T_before, error))std::cout << "\"s_maT with ld\" failed" << std::endl;

	s_ma(2, 3, alpha, m5T, ColMajor{2}, o5T_before, 3);
	if (!s_is_equal(6, o5, o5T_before, error))std::cout << "\"s_maT\" failed" << std::endl;

	s_ma(2, 3, alpha, m6T, ColMajor{ 5 }, o6T_before, 4);
	if (!s_is_equal(8, o6, o6T_before, error))std::cout << "\"s_maT with ld\" failed" << std::endl;

	s_mm(2, 4, 3, m7a, m7b, result);
	if (!s_is_equal(8, o7, result, error))std::cout << "\"s_mm\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mm(2, 4, 3, m8a, 6, m8b, 6, result, 5);
	if (!s_is_equal(10, o8, result, error))std::cout << "\"s_mm with ld\" failed" << std::endl;

	s_mm(2, 4, 3, alpha, m9a, m9b, result);
	if (!s_is_equal(8, o9, result, error))std::cout << "\"s_mm\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mm(2, 4, 3, alpha, m10a, 6, m10b, 6, result, 5);
	if (!s_is_equal(10, o10, result, error))std::cout << "\"s_mm with ld\" failed" << std::endl;

	s_mm(2, 4, 3, m11a, ColMajor{2}, m11b, 4, result, 4);
	if (!s_is_equal(8, o11, result, error))std::cout << "\"s_mmTN\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mm(2, 4, 3, m12a, ColMajor{ 5 }, m12b, 6, result, 5);
	if (!s_is_equal(10, o12, result, error))std::cout << "\"s_mmTN with ld\" failed" << std::endl;

	s_mm(2, 4, 3, alpha, m13a, ColMajor{2}, m13b, 4, result, 4);
	if (!s_is_equal(8, o13, result, error))std::cout << "\"s_mmTN\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mm(2, 4, 3, alpha, m14a, ColMajor{ 5 }, m14b, 6, result, 5);
	if (!s_is_equal(10, o14, result, error))std::cout << "\"s_mmTN with ld\" failed" << std::endl;

	s_mm(2, 4, 3, m15a, 3, m15b, ColMajor{3}, result, 4);
	if (!s_is_equal(8, o15, result, error))std::cout << "\"s_mmNT\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mm(2, 4, 3, m16a, 6, m16b, ColMajor{ 5 }, result, 5);
	if (!s_is_equal(10, o16, result, error))std::cout << "\"s_mmNT with ld\" failed" << std::endl;

	s_mm(2, 4, 3, alpha, m17a, 3, m17b, ColMajor{ 3 }, result, 4);
	if (!s_is_equal(8, o17, result, error))std::cout << "\"s_mmNT\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mm(2, 4, 3, alpha, m18a, 6, m18b, ColMajor{ 5 }, result, 5);
	if (!s_is_equal(10, o18, result, error))std::cout << "\"s_mmNT with ld\" failed" << std::endl;

	s_mm(2, 4, 3, m19a, ColMajor{ 2 }, m19b, ColMajor{3}, result, 4);
	if (!s_is_equal(8, o19, result, error))std::cout << "\"s_mmTT\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mm(2, 4, 3, m20a, ColMajor{ 5 }, m20b, ColMajor{ 5 }, result, 5);
	if (!s_is_equal(10, o20, result, error))std::cout << "\"s_mmTT with ld\" failed" << std::endl;

	s_mm(2, 4, 3, alpha, m21a, ColMajor{ 2 }, m21b, ColMajor{3}, result, 4);
	if (!s_is_equal(8, o21, result, error))std::cout << "\"s_mmTT\" failed" << std::endl;

	std::fill_n(result, 36, 0);
	s_mm(2, 4, 3, alpha, m22a, ColMajor{ 5 }, m22b, ColMajor{ 5 }, result, 5);
	if (!s_is_equal(10, o22, result, error))std::cout << "\"s_mmTT with ld\" failed" << std::endl;

	const double ma01a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double ma01b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616 };
	const double oa01[]{ 2.31858183661872,3.09529802045975,3.989581394872564,4.962509892352645,5.774959561865027,6.749377875701963,8.0047379842151,9.32916821737827 };
	double oa01_before[]{ 1,2,3,4,5,6,7,8 };
	const double ma02a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0,0 };
	const double ma02b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0,0,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0,0,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616,0,0 };
	const double oa02[]{ 2.31858183661872,3.09529802045975,3.989581394872564,4.962509892352645,0,5.774959561865027,6.749377875701963,8.0047379842151,9.32916821737827,0 };
	double oa02_before[]{ 1,2,3,4,0,5,6,7,8,0 };
	const double ma03a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double ma03b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616 };
	const double oa03[]{ 1.336363785854748,2.27940517499149,3.252437380181361,4.245531572120387,5.197688398910224,6.191162635724814,7.256303752089665,8.339064319876901 };
	double oa03_before[]{ 1,2,3,4,5,6,7,8 };
	const double ma04a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0,0 };
	const double ma04b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0,0,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0,0,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616,0,0 };
	const double oa04[]{ 1.336363785854748,2.27940517499149,3.252437380181361,4.245531572120387,0,5.197688398910224,6.191162635724814,7.256303752089665,8.339064319876901,0 };
	double oa04_before[]{ 1,2,3,4,0,5,6,7,8,0 };

	const double ma05a[]{ 0.498364051982143,0.585267750979777,0.959743958516081,0.223811939491137,0.340385726666133,0.751267059305653 };
	const double ma05b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616 };
	const double oa05[]{ 2.31858183661872,3.09529802045975,3.989581394872564,4.962509892352645,5.774959561865027,6.749377875701963,8.0047379842151,9.32916821737827 };
	double oa05_before[]{ 1,2,3,4,5,6,7,8 };
	const double ma06a[]{ 0.498364051982143,0.585267750979777,0,0,0,0.959743958516081,0.223811939491137,0,0,0,0.340385726666133,0.751267059305653,0,0,0 };
	const double ma06b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0,0,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0,0,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616,0,0 };
	const double oa06[]{ 2.31858183661872,3.09529802045975,3.989581394872564,4.962509892352645,0,5.774959561865027,6.749377875701963,8.0047379842151,9.32916821737827,0 };
	double oa06_before[]{ 1,2,3,4,0,5,6,7,8,0 };
	const double ma07a[]{ 0.498364051982143,0.585267750979777,0.959743958516081,0.223811939491137,0.340385726666133,0.751267059305653 };
	const double ma07b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616 };
	const double oa07[]{ 1.336363785854748,2.27940517499149,3.252437380181361,4.245531572120387,5.197688398910224,6.191162635724814,7.256303752089665,8.339064319876901 };
	double oa07_before[]{ 1,2,3,4,5,6,7,8 };
	const double ma08a[]{ 0.498364051982143,0.585267750979777,0,0,0,0.959743958516081,0.223811939491137,0,0,0,0.340385726666133,0.751267059305653,0,0,0 };
	const double ma08b[]{ 0.814723686393179,0.913375856139019,0.278498218867048,0.964888535199277,0,0,0.905791937075619,0.63235924622541,0.546881519204984,0.157613081677548,0,0,0.126986816293506,0.0975404049994095,0.957506835434298,0.970592781760616,0,0 };
	const double oa08[]{ 1.336363785854748,2.27940517499149,3.252437380181361,4.245531572120387,0,5.197688398910224,6.191162635724814,7.256303752089665,8.339064319876901,0 };
	double oa08_before[]{ 1,2,3,4,0,5,6,7,8,0 };

	const double ma09a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double ma09b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0.913375856139019,0.63235924622541,0.0975404049994095,0.278498218867048,0.546881519204984,0.957506835434298,0.964888535199277,0.157613081677548,0.970592781760616 };
	const double oa09[]{ 2.31858183661872,3.09529802045975,3.989581394872564,4.962509892352645,5.774959561865027,6.749377875701963,8.0047379842151,9.32916821737827 };
	double oa09_before[]{ 1,2,3,4,5,6,7,8 };
	const double ma10a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0,0 };
	const double ma10b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0,0,0.913375856139019,0.63235924622541,0.0975404049994095,0,0,0.278498218867048,0.546881519204984,0.957506835434298,0,0,0.964888535199277,0.157613081677548,0.970592781760616,0,0 };
	const double oa10[]{ 2.31858183661872,3.09529802045975,3.989581394872564,4.962509892352645,0,5.774959561865027,6.749377875701963,8.0047379842151,9.32916821737827,0 };
	double oa10_before[]{ 1,2,3,4,0,5,6,7,8,0 };
	const double ma11a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0.585267750979777,0.223811939491137,0.751267059305653 };
	const double ma11b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0.913375856139019,0.63235924622541,0.0975404049994095,0.278498218867048,0.546881519204984,0.957506835434298,0.964888535199277,0.157613081677548,0.970592781760616 };
	const double oa11[]{ 1.336363785854748,2.27940517499149,3.252437380181361,4.245531572120387,5.197688398910224,6.191162635724814,7.256303752089665,8.339064319876901 };
	double oa11_before[]{ 1,2,3,4,5,6,7,8 };
	const double ma12a[]{ 0.498364051982143,0.959743958516081,0.340385726666133,0,0,0,0.585267750979777,0.223811939491137,0.751267059305653,0,0,0 };
	const double ma12b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0,0,0.913375856139019,0.63235924622541,0.0975404049994095,0,0,0.278498218867048,0.546881519204984,0.957506835434298,0,0,0.964888535199277,0.157613081677548,0.970592781760616,0,0 };
	const double oa12[]{ 1.336363785854748,2.27940517499149,3.252437380181361,4.245531572120387,0,5.197688398910224,6.191162635724814,7.256303752089665,8.339064319876901,0 };
	double oa12_before[]{ 1,2,3,4,0,5,6,7,8,0 };

	const double ma13a[]{ 0.498364051982143,0.585267750979777,0.959743958516081,0.223811939491137,0.340385726666133,0.751267059305653 };
	const double ma13b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0.913375856139019,0.63235924622541,0.0975404049994095,0.278498218867048,0.546881519204984,0.957506835434298,0.964888535199277,0.157613081677548,0.970592781760616 };
	const double oa13[]{ 2.31858183661872,3.09529802045975,3.989581394872564,4.962509892352645,5.774959561865027,6.749377875701963,8.0047379842151,9.32916821737827 };
	double oa13_before[]{ 1,2,3,4,5,6,7,8 };
	const double ma14a[]{ 0.498364051982143,0.585267750979777,0,0,0,0.959743958516081,0.223811939491137,0,0,0,0.340385726666133,0.751267059305653,0,0,0 };
	const double ma14b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0,0,0.913375856139019,0.63235924622541,0.0975404049994095,0,0,0.278498218867048,0.546881519204984,0.957506835434298,0,0,0.964888535199277,0.157613081677548,0.970592781760616,0,0 };
	const double oa14[]{ 2.31858183661872,3.09529802045975,3.989581394872564,4.962509892352645,0,5.774959561865027,6.749377875701963,8.0047379842151,9.32916821737827,0 };
	double oa14_before[]{ 1,2,3,4,0,5,6,7,8,0 };
	const double ma15a[]{ 0.498364051982143,0.585267750979777,0.959743958516081,0.223811939491137,0.340385726666133,0.751267059305653 };
	const double ma15b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0.913375856139019,0.63235924622541,0.0975404049994095,0.278498218867048,0.546881519204984,0.957506835434298,0.964888535199277,0.157613081677548,0.970592781760616 };
	const double oa15[]{ 1.336363785854748,2.27940517499149,3.252437380181361,4.245531572120387,5.197688398910224,6.191162635724814,7.256303752089665,8.339064319876901 };
	double oa15_before[]{ 1,2,3,4,5,6,7,8 };
	const double ma16a[]{ 0.498364051982143,0.585267750979777,0,0,0,0.959743958516081,0.223811939491137,0,0,0,0.340385726666133,0.751267059305653,0,0,0 };
	const double ma16b[]{ 0.814723686393179,0.905791937075619,0.126986816293506,0,0,0.913375856139019,0.63235924622541,0.0975404049994095,0,0,0.278498218867048,0.546881519204984,0.957506835434298,0,0,0.964888535199277,0.157613081677548,0.970592781760616,0,0 };
	const double oa16[]{ 1.336363785854748,2.27940517499149,3.252437380181361,4.245531572120387,0,5.197688398910224,6.191162635724814,7.256303752089665,8.339064319876901,0 };
	double oa16_before[]{ 1,2,3,4,0,5,6,7,8,0 };

	s_mma(2, 4, 3, ma01a, ma01b, oa01_before);
	if (!s_is_equal(8, oa01_before, oa01, error))std::cout << "\"s_mma\" failed" << std::endl;

	s_mma(2, 4, 3, ma02a, 6, ma02b, 6, oa02_before, 5);
	if (!s_is_equal(10, oa02_before, oa02, error))std::cout << "\"s_mma with ld\" failed" << std::endl;

	s_mma(2, 4, 3, alpha, ma03a, ma03b, oa03_before);
	if (!s_is_equal(8, oa03_before, oa03, error))std::cout << "\"s_mma\" failed" << std::endl;

	s_mma(2, 4, 3, alpha, ma04a, 6, ma04b, 6, oa04_before, 5);
	if (!s_is_equal(10, oa04_before, oa04, error))std::cout << "\"s_mma with ld\" failed" << std::endl;

	s_mma(2, 4, 3, ma06a, ColMajor{ 5 }, ma06b, RowMajor{ 6 }, oa06_before, RowMajor{ 5 });
	if (!s_is_equal(10, oa06_before, oa06, error))std::cout << "\"s_mmaTN with ld\" failed" << std::endl;

	s_mma(2, 4, 3, alpha, ma08a, ColMajor{ 5 }, ma08b, RowMajor{ 6 }, oa08_before, RowMajor{ 5 });
	if (!s_is_equal(10, oa08_before, oa08, error))std::cout << "\"s_mmaTN with ld\" failed" << std::endl;

	s_mma(2, 4, 3, ma10a, RowMajor{ 6 }, ma10b, ColMajor{ 5 }, oa10_before, RowMajor{ 5 });
	if (!s_is_equal(10, oa06_before, oa10, error))std::cout << "\"s_mmaNT with ld\" failed" << std::endl;

	s_mma(2, 4, 3, alpha, ma12a, RowMajor{ 6 }, ma12b, ColMajor{ 5 }, oa12_before, RowMajor{ 5 });
	if (!s_is_equal(10, oa12_before, oa12, error))std::cout << "\"s_mmaNT with ld\" failed" << std::endl;

	s_mma(2, 4, 3, ma14a, ColMajor{ 5 }, ma14b, ColMajor{ 5 }, oa14_before, RowMajor{ 5 });
	if (!s_is_equal(10, oa14_before, oa14, error))std::cout << "\"s_mmaTT with ld\" failed" << std::endl;

	s_mma(2, 4, 3, alpha, ma16a, ColMajor{ 5 }, ma16b, ColMajor{ 5 }, oa16_before, RowMajor{ 5 });
	if (!s_is_equal(10, oa16_before, oa16, error))std::cout << "\"s_mmaTT with ld\" failed" << std::endl;
}
void test_llt()
{
	const double A[]{ 1.82553083943141,1.42060601118548,1.36736238745112,1.50658906468564,1.86464891726001,1.04079482779702,
		1.42060601118548,2.10941693872417,1.92463386848915,1.23889223270807,2.23186828169132,1.22211204078486,
		1.36736238745112,1.92463386848915,2.06653199450749,1.37659815598197,2.07988145626914,1.30113287432829,
		1.50658906468564,1.23889223270807,1.37659815598197,1.69212820994619,1.67619205287543,0.914095057763804,
		1.86464891726001,2.23186828169132,2.07988145626914,1.67619205287543, 3.0881251584706,1.69495025317372,
		1.04079482779702,1.22211204078486,1.30113287432829,0.914095057763804,1.69495025317372,1.17872570447206 };

	const double A_ld[]{ 1.82553083943141,1.42060601118548,1.36736238745112,1.50658906468564,1.86464891726001,1.04079482779702,0.0,
		1.42060601118548,2.10941693872417,1.92463386848915,1.23889223270807,2.23186828169132,1.22211204078486,0.0,
		1.36736238745112,1.92463386848915,2.06653199450749,1.37659815598197,2.07988145626914,1.30113287432829,0.0,
		1.50658906468564,1.23889223270807,1.37659815598197,1.69212820994619,1.67619205287543,0.914095057763804,0.0,
		1.86464891726001,2.23186828169132,2.07988145626914,1.67619205287543, 3.0881251584706,1.69495025317372,0.0,
		1.04079482779702,1.22211204078486,1.30113287432829,0.914095057763804,1.69495025317372,1.17872570447206,0.0 };

	const double b[]{ 0.765516788149002,0.709364830858073,
		0.795199901137063,0.754686681982361,
		0.186872604554379,0.276025076998578,
		0.489764395788231,0.679702676853675,
		0.445586200710899,0.655098003973841,
		0.646313010111265,0.162611735194631 };

	const double bT[]{ 0.765516788149002,0.795199901137063,0.186872604554379,0.489764395788231,0.445586200710899,0.646313010111265,
		0.709364830858073,0.754686681982361,0.276025076998578,0.679702676853675,0.655098003973841,0.162611735194631 };

	const double llt[]{ 1.35112206681388,1.05142684445637,1.01201987669074,1.11506510158506,1.38007435675823,0.770318873002606,
		1.05142684445637,1.00195734913254,0.858887859606139,0.0663529756457487,0.779295701883798,0.411372898532454,
		1.01201987669074,0.858887859606139,0.551959607499983,0.346294079395723,0.025166983849247,0.30478983036659,
		1.11506510158506,0.0663529756457487,0.346294079395723,0.569592593325883,0.135000937041167, -0.136419197085494,
		1.38007435675823,0.779295701883798,0.025166983849247,0.135000937041167,0.746565139312267,0.431332592509531,
		0.770318873002606,0.411372898532454,0.30478983036659,-0.136419197085494,0.431332592509531,0.344313858756401 };

	const double llt_ld[]{ 1.35112206681388,1.05142684445637,1.01201987669074,1.11506510158506,1.38007435675823,0.770318873002606,0.0,
		1.05142684445637,1.00195734913254,0.858887859606139,0.0663529756457487,0.779295701883798,0.411372898532454,0.0,
		1.01201987669074,0.858887859606139,0.551959607499983,0.346294079395723,0.025166983849247,0.30478983036659,0.0,
		1.11506510158506,0.0663529756457487,0.346294079395723,0.569592593325883,0.135000937041167, -0.136419197085494,0.0,
		1.38007435675823,0.779295701883798,0.025166983849247,0.135000937041167,0.746565139312267,0.431332592509531,0.0,
		0.770318873002606,0.411372898532454,0.30478983036659,-0.136419197085494,0.431332592509531,0.344313858756401,0.0 };

	const double inv_l[]{ 0.740125577519527,0,0,0,0,0,
		-0.77666769064225,0.998046474598712,0,0,0,0,
		-0.148473446503069, -1.55303031002242,1.81172677567722,0,0,0,
		-1.26816697217082,0.827928336123375, -1.10147193494276,1.75564080663506,0,0,
		-0.323125426175609, -1.13916294185447,0.138104552985304, -0.31747149916724,1.3394678472681,0,
		-0.69415520561586,1.93742418585395, -2.21317495390761,1.09330166190531, -1.67799269315532,2.90432689410723 };

	const double inv_l_dot_b[]{ 0.566578554929674,0.525019055110873,
		0.19909430193153,0.202271637373723,
		-1.01006636357342,-0.777291110197726,
		0.341580853217506,0.614513319403422,
		-0.686050087570733,-0.389108108915027,
		2.26054438577134,0.474995191389852 };
	const double inv_u_dot_b[]{ -1.29249793785305,-1.28863719172842,
		1.65350463041262,0.456066717040007,
		-1.56976591868037,-0.518007602446926,
		1.42500452780045,1.16312249077394,
		-0.487660119419236,0.604621409654585,
		1.87710425727744,0.472277635823185 };


	const double B[]{ 0.854463601335834,0.915158806735392,0.81779406393944,0,0,0,
		0.915158806735392,1.51973084603713,1.08911106493401,0,0,0,
		0.81779406393944,1.08911106493401,1.00718816511107,0,0,0,
		0,0,0,1.16505945742745,0.55867090856838,1.06119850911405,
		0,0,0,0.55867090856838,0.321956437380287,0.442097312015519,
		0,0,0,1.06119850911405,0.442097312015519,1.05023839402297 };

	const double B_llt[]{ 0.924372003760301,0.990033020269512,0.88470232829715,0,0,0,
		0.990033020269512,0.734551199585949,0.290281394858118,0,0,0,
		0.88470232829715,0.290281394858118,0.374468512983265,0,0,0,
		0,0,0,1.07937920001613,0.517585394048759,0.983156344960322,
		0,0,0,0.517585394048759,0.232511929258862, -0.287168286010691,
		0,0,0,0.983156344960322, -0.287168286010691,0.0342982637594407 };

	const double C[]{ 1.09756159899368,0.494892128610864,0,0,0,0.599982575914901,
		0.494892128610864,0.564212545623307,0,0,0,0.200848874880563,
		0,0,0.979041348469538,0.638782936554467,0.663380272499309,0,
		0,0,0.638782936554467,0.791575910209436,0.454993751889092,0,
		0,0,0.663380272499309,0.454993751889092,0.470703623796929,0,
		0.599982575914901,0.200848874880563,0,0,0,1.00673482446645 };

	const double C_llt[]{ 1.04764574117097,0.472384995387576,0,0,0,0.572696048231236,
		0.472384995387576,0.584007672685888,0,0,0, -0.119320598822187,
		0,0,0.989465183050691,0.645584046307713,0.670443269619648,0,
		0,0,0.645584046307713,0.612206786439351,0.0362071665314066,0,
		0,0,0.670443269619648,0.0362071665314066,0.141061997399768,0,
		0.572696048231236, -0.119320598822187,0,0,0,0.815178910119423 };
	double result[100];

	s_llt(6, A, result);
	if (!s_is_equal(6, 6, llt, result, error))std::cout << "\"s_llt\" failed" << std::endl;

	s_llt(6, A_ld, 7, result, ColMajor{ 8 });
	if (!s_is_equal(6, 6, llt, 6, result, ColMajor{ 8 }, error))std::cout << "\"s_llt\" failed" << std::endl;

	s_mc(6, 6, A, result);
	s_llt(6, result, result);
	if (!s_is_equal(6, 6, llt, result, error))std::cout << "\"s_llt\" failed" << std::endl;

	s_mc(6, 6, A, 7, result, ColMajor{ 8 });
	s_llt(6, result, ColMajor{ 8 }, result, ColMajor{ 8 });
	if (!s_is_equal(6, 6, llt, 6, result, ColMajor{ 8 }, error))std::cout << "\"s_llt\" failed" << std::endl;

	s_inv_lm(6, llt, result);
	if (!s_is_equal(6, 6, inv_l, result, error))std::cout << "\"s_inv_lm\" failed" << std::endl;

	s_mc(6, 6, llt, result);
	s_inv_lm(6, result, result);
	if (!s_is_equal(6, 6, inv_l, result, error))std::cout << "\"s_inv_lm\" failed" << std::endl;

	s_inv_lm(6, llt_ld, 7, result, ColMajor{ 8 });
	if (!s_is_equal(6, 6, inv_l, 6, result, ColMajor{ 8 }, error))std::cout << "\"s_inv_lm\" failed" << std::endl;

	s_mc(6, 6, llt, 6, result, ColMajor{ 8 });
	s_inv_lm(6, result, ColMajor{ 8 }, result, ColMajor{ 8 });
	if (!s_is_equal(6, 6, inv_l, 6, result, ColMajor{ 8 }, error))std::cout << "\"s_inv_lm\" failed" << std::endl;

	s_inv_um(6, llt, result);
	if (!s_is_equal(6, 6, inv_l, ColMajor{ 6 }, result, 6, error))std::cout << "\"s_inv_um\" failed" << std::endl;

	s_mc(6, 6, llt, result);
	s_inv_um(6, result, result);
	if (!s_is_equal(6, 6, inv_l, ColMajor{ 6 }, result, 6, error))std::cout << "\"s_inv_um\" failed" << std::endl;

	s_inv_um(6, llt_ld, 7, result, ColMajor{ 8 });
	if (!s_is_equal(6, 6, inv_l, ColMajor{ 6 }, result, ColMajor{ 8 }, error))std::cout << "\"s_inv_um\" failed" << std::endl;

	s_mc(6, 6, llt, 6, result, ColMajor{ 8 });
	s_inv_um(6, result, ColMajor{ 8 }, result, ColMajor{ 8 });
	if (!s_is_equal(6, 6, inv_l, ColMajor{ 6 }, result, ColMajor{ 8 }, error))std::cout << "\"s_inv_um\" failed" << std::endl;

	s_sov_lm(6, 2, llt, b, result);
	if (!s_is_equal(6, 2, inv_l_dot_b, result, error))std::cout << "\"s_sov_lm\" failed" << std::endl;

	s_mc(6, 2, b, result);
	s_sov_lm(6, 2, llt, result, result);
	if (!s_is_equal(6, 2, inv_l_dot_b, result, error))std::cout << "\"s_sov_lm\" failed" << std::endl;

	s_sov_lm(6, 2, llt, 6, bT, ColMajor{ 6 }, result, 2);
	if (!s_is_equal(6, 2, inv_l_dot_b, result, error))std::cout << "\"s_sov_lmNT\" failed" << std::endl;

	s_mc(6, 2, bT, ColMajor{ 6 }, result, ColMajor{ 6 });
	s_sov_lm(6, 2, llt, 6, result, ColMajor{ 6 }, result, ColMajor{ 6 });
	if (!s_is_equal(6, 2, inv_l_dot_b, 2, result, ColMajor{ 6 }, error))std::cout << "\"s_sov_lmNT\" failed" << std::endl;

	s_sov_um(6, 2, llt, b, result);
	if (!s_is_equal(6, 2, inv_u_dot_b, result, error))std::cout << "\"s_sov_um\" failed" << std::endl;

	s_mc(6, 2, b, result);
	s_sov_um(6, 2, llt, result, result);
	if (!s_is_equal(6, 2, inv_u_dot_b, result, error))std::cout << "\"s_sov_um\" failed" << std::endl;

	s_sov_um(6, 2, llt, 6, bT, ColMajor{ 6 }, result, 2);
	if (!s_is_equal(6, 2, inv_u_dot_b, result, error))std::cout << "\"s_sov_lmNT\" failed" << std::endl;

	s_mc(6, 2, bT, ColMajor{ 6 }, result, ColMajor{ 6 });
	s_sov_um(6, 2, llt, 6, result, ColMajor{ 6 }, result, ColMajor{ 6 });
	if (!s_is_equal(6, 2, inv_u_dot_b, 2, result, ColMajor{ 6 }, error))std::cout << "\"s_sov_umNT\" failed" << std::endl;
}
void test_householder() 
{
	{
		// test 5*6 mat
		const int m{ 5 }, n{ 6 }, rhs{ 2 };
		const int a_t{ 7 }, q_t{ 8 }, r_t{ 10 }, u_t{ 9 }, tau_t{ 2 }, b_t{ 4 }, x_t{ 5 };

		const double A[]{ 
			0.8147,0.0975,0.1576,0.1419,0.6557,0.7577,
			0.9058,0.2785,0.9706,0.4218,0.0357,0.7431,
			0.1270,0.5469,0.9572,0.9157,0.8491,0.3922,
			0.9134,0.9575,0.4854,0.7922,0.9340,0.6555,
			0.6324,0.9649,0.8003,0.9595,0.6787,0.1712, };
		const double Q[]{
			-0.492666858742303, -0.480667841387474,0.177953454506114,0.656659986061627,0.25173006035788,
			-0.547757015648433, -0.358349168353002, -0.57774356601946, -0.475777233310347, -0.106754491874129,
			-0.0767996698910918,0.475432019801101, -0.634320532325754,0.554658862728443, -0.240950645401142,
			-0.552352901405695,0.339054939876482,0.480845521478708, -0.0718314601196047, -0.586153432016755,
			-0.382426072749027,0.547312015298238,0.0311446094260189, -0.172126332392726,0.723603756065892,};
		const double R[]{
			-1.65365294121832, - 1.14046790774039, - 1.25697758470928, - 1.1757905794716, - 1.18325736992819, - 1.23799141825475,
			0,0.966094882200634,0.634107648406748,1.0097398566765,0.763860337732694, - 0.128076522148321,
			0,0,-0.881556607241129, - 0.388478877543586,0.0277046342935185 ,- 0.222740227744911,
			0,0,0,0.178338236974704,0.700634820427496,0.284984865114035,
			0,0,0,0,-0.0997003640550825,-0.243436850953329,};
		const double U[]{
			-1.65365294121832, - 1.14046790774039, - 1.25697758470928, - 1.1757905794716, - 1.18325736992819, - 1.23799141825475,
			0.366965349595799,0.966094882200634,0.634107648406748,1.0097398566765,0.763860337732694, - 0.128076522148321,
			0.0514513130919259, - 0.423163816226815, - 0.881556607241129, - 0.388478877543586,0.0277046342935185, - 0.222740227744911,
			0.370044325812324, - 0.437343928487383, - 0.0698283162531727,0.178338236974704,0.700634820427497,0.284984865114035,
			0.256203231490819, - 0.567244456473452,0.197960951688692,0.489745227556259, - 0.0997003640550822, - 0.243436850953329};
		const double tau[]{
			-1.4926668587423,
			- 1.18196072589879,
			- 1.91559040502267,
			- 1.61309785397955};
		const double b[]{ 0.4387,0.4898,
			0.3816,0.4456,
			0.7655,0.6463,
			0.7952,0.7094,
			0.1869,0.7547 };
		const double x[]{ -2.75456661995493,0.868590789483354,
			7.99831100006118, - 1.88123572093792,
			7.05877107200108, - 1.35425833135642,
			- 15.0821489767352,3.59223425153636,
			4.4695817014224, - 0.504388227347691,
			0, 0};
		
		const double A_ld[]{
			0.8147,0.0975,0.1576,0.1419,0.6557,0.7577,0,
			0.9058,0.2785,0.9706,0.4218,0.0357,0.7431,0,
			0.1270,0.5469,0.9572,0.9157,0.8491,0.3922,0,
			0.9134,0.9575,0.4854,0.7922,0.9340,0.6555,0,
			0.6324,0.9649,0.8003,0.9595,0.6787,0.1712,0 };
		const double Q_ld[]{
			-0.492666858742303,-0.480667841387474,0.177953454506114,0.656659986061627,0.25173006035788,0,0,0,
			-0.547757015648433,-0.358349168353002,-0.57774356601946,-0.475777233310347,-0.106754491874129,0,0,0,
			-0.0767996698910918,0.475432019801101,-0.634320532325754,0.554658862728443,-0.240950645401142,0,0,0,
			-0.552352901405695,0.339054939876482,0.480845521478708,-0.0718314601196047,-0.586153432016755,0,0,0,
			-0.382426072749027,0.547312015298238,0.0311446094260189,-0.172126332392726,0.723603756065892,0,0,0 };
		const double R_ld[]{
			-1.65365294121832, -1.14046790774039, -1.25697758470928, -1.1757905794716, -1.18325736992819, -1.23799141825475,0,0,0,0,
			0,0.966094882200634,0.634107648406748,1.0097398566765,0.763860337732694, -0.128076522148321,0,0,0,0,
			0,0,-0.881556607241129, -0.388478877543586,0.0277046342935185 ,-0.222740227744911,0,0,0,0,
			0,0,0,0.178338236974704,0.700634820427496,0.284984865114035,0,0,0,0,
			0,0,0,0,-0.0997003640550825,-0.243436850953329,0,0,0,0 };
		const double U_ld[]{
			-1.65365294121832, -1.14046790774039, -1.25697758470928, -1.1757905794716, -1.18325736992819, -1.23799141825475,0,0,0,
			0.366965349595799,0.966094882200634,0.634107648406748,1.0097398566765,0.763860337732694, -0.128076522148321,0,0,0,
			0.0514513130919259, -0.423163816226815, -0.881556607241129, -0.388478877543586,0.0277046342935185, -0.222740227744911,0,0,0,
			0.370044325812324, -0.437343928487383, -0.0698283162531727,0.178338236974704,0.700634820427497,0.284984865114035,0,0,0,
			0.256203231490819, -0.567244456473452,0.197960951688692,0.489745227556259, -0.0997003640550822, -0.243436850953329,0,0,0 };
		const double tau_ld[]{
			-1.4926668587423,0,
			-1.18196072589879,0,
			-1.91559040502267,0,
			-1.61309785397955,0,
			0.0, 0 };
		const double b_ld[]{ 0.4387,0.4898,0,0,
			0.3816,0.4456,0,0,
			0.7655,0.6463,0,0,
			0.7952,0.7094,0,0,
			0.1869,0.7547,0,0 };
		const double x_ld[]{ -2.75456661995493,0.868590789483354,0,0,0,
			7.99831100006118, -1.88123572093792,0,0,0,
			7.05877107200108, -1.35425833135642,0,0,0,
			-15.0821489767352,3.59223425153636,0,0,0,
			4.4695817014224, -0.504388227347691,0,0,0,
			0,0,0,0,0 };

		double result_Q[m*m], result_R[m*n], result_U[m*n], result_tau[std::max(m, n)], result_x[std::max(m, n)*rhs];
		double result_Q_ld[m*q_t], result_R_ld[m*r_t], result_U_ld[m*u_t], result_tau_ld[n*tau_t], result_x_ld[std::max(m, n)*x_t];
		
		s_householder_ut(m, n, A, result_U, result_tau);
		if (!(s_is_equal(m, n, result_U, U, error) && s_is_equal(std::min(m - 1, n), result_tau, tau, error)))std::cout << "\"s_householder\" failed" << std::endl;

		s_householder_ut(m, n, A_ld, a_t, result_U_ld, u_t, result_tau_ld, tau_t);
		if (!(s_is_equal(m, n, result_U_ld, u_t, U_ld, u_t, error) && s_is_equal(std::min(m - 1, n), 1, result_tau_ld, tau_t, tau_ld, tau_t, error)))std::cout << "\"s_householder_ut\" failed" << std::endl;

		s_mc(m, n, A_ld, a_t, result_U_ld, u_t);
		s_householder_ut(m, n, result_U_ld, u_t, result_U_ld, u_t, result_tau_ld, tau_t);
		if (!(s_is_equal(m, n, result_U_ld, u_t, U_ld, u_t, error) && s_is_equal(std::min(m - 1, n), 1, result_tau_ld, tau_t, tau_ld, tau_t, error)))std::cout << "\"s_householder_ut\" failed" << std::endl;

		s_householder_ut2qr(m, n, U, tau, result_Q, result_R);
		if (!(s_is_equal(m, m, result_Q, Q, error) && s_is_equal(m, n, result_R, R, error)))std::cout << "\"s_householder_ut2qr\" failed" << std::endl;

		s_householder_ut2qr(m, n, U_ld, u_t, tau_ld, tau_t, result_Q_ld, q_t, result_R_ld, r_t);
		if (!(s_is_equal(m, m, result_Q_ld, q_t, Q_ld, q_t, error) && s_is_equal(m, n, result_R_ld, r_t, R_ld, r_t, error)))std::cout << "\"s_householder_ut2qr\" failed" << std::endl;

		s_householder_ut_sov(m, n, 2, U, tau, b, result_x);
		if (!(s_is_equal(n, rhs, result_x, x, error)))std::cout << "\"s_householder_ut_sov\" failed" << std::endl;

		s_householder_ut_sov(m, n, rhs, U_ld, u_t, tau_ld, tau_t, b_ld, b_t, result_x_ld, x_t);
		if (!(s_is_equal(n, rhs, result_x_ld, x_t, x_ld, x_t, error)))std::cout << "\"s_householder_ut_sov\" failed" << std::endl;
	}
	{
	// test 6*5 mat	
		const aris::Size m{ 6 }, n{ 5 }, rhs{ 2 };
		const aris::Size a_t{ 9 }, q_t{ 8 }, r_t{ 6 }, u_t{ 7 }, tau_t{ 2 }, b_t{ 4 }, x_t{ 3 };
		const double A[]{ 0.8147,0.9058, 0.127,0.9134,0.6324,
			0.0975,0.2785,0.5469,0.9575,0.9649,
			0.1576,0.9706,0.9572,0.4854,0.8003,
			0.1419,0.4218,0.9157,0.7922,0.9595,
			0.6557,0.0357,0.8491, 0.934,0.6787,
			0.7577,0.7431,0.3922,0.6555,0.1712 };
		const double Q[]{
			-0.6207938622228, - 0.154560758796689,0.479344322039396, - 0.321468254294596, 0.500625274984451, 0.0835910815985244,
			- 0.07429409790932, - 0.17707859766604, - 0.287176127497771, - 0.79778986158619, - 0.321450823922257, - 0.37530538713139,
			- 0.120089741851373, - 0.771426698803364, - 0.254652968468967, 0.386622567240651, 0.169145687493211, - 0.384114429341121,
			- 0.108126487111103, - 0.273077416783337, - 0.506838341291211, - 0.139647719197317, 0.0441331940078665, 0.797121733949575,
			- 0.499637333324524,   0.521984537055711, - 0.580180031408702, 0.157727038950421, 0.239035801052366, - 0.243454053933954,
			- 0.57736038959889, - 0.0511454590343965, 0.171513222014195, 0.257552294569938, - 0.747226595652759, 0.0997074095924538 };
		const double R[]{
			-1.31235189259588, - 1.19204640068418, - 0.984116392323211, - 1.62724008099373, - 1.10207955515584,
			0, - 1.07261967566136, - 0.681782306693105, - 0.447503294312055, - 0.80248312849391,
			0,0, - 1.22940896476355, - 0.79172515549949, - 1.02847417900777,
			0,0,0, - 0.664332641480675, - 0.646519613301525,
			0,0,0,0,0.218449022247435,
			0,0,0,0,0 };
		const double U[]{
			-1.31235189259588, - 1.19204640068418, - 0.984116392323211, - 1.62724008099373,-1.10207955515584,
			0.0458380918394095, - 1.07261967566136, - 0.681782306693105, - 0.447503294312055,-0.802483128493911,
			0.0740931617834968,0.64955454096634, - 1.22940896476355, - 0.79172515549949,- 1.02847417900777,
			0.0667120536616637,0.224587809775278,0.43088167987985, - 0.664332641480675,- 0.646519613301525,
			0.30826704429847, - 0.486866265436373,0.806399797389196,0.64673735967616,0.218449022247434,
			0.356220740376622, - 0.00334385430562029,0.000250527139268941, - 0.275874736646322,0.711610030647557 };
		const double tau[]{
			-1.6207938622228,
			- 1.16999382740955,
			- 1.08936038603983,
			- 1.33835118423397,
			- 1.32767845364868,
			0 };
		const double b[]{
			0.5060,0.1493,
			0.6991,0.2575,
			0.8909,0.8407,
			0.9593,0.2543,
			0.5472,0.8143,
			0.1386,0.2435
		};
		const double x[]{
			0.209748905164346, 0.947708395923203,
			0.072279163615098, -0.200871645791878,
			0.169848963487236, 0.699653165641312,
			-0.524722596591983, -1.04635860123482,
			1.13918462877824,0.723696504731286,
		};
		const double A_ld[]{ 0.8147,0.9058, 0.127,0.9134,0.6324,0,0,0,0,
			0.0975,0.2785,0.5469,0.9575,0.9649,0,0,0,0,
			0.1576,0.9706,0.9572,0.4854,0.8003,0,0,0,0,
			0.1419,0.4218,0.9157,0.7922,0.9595,0,0,0,0,
			0.6557,0.0357,0.8491, 0.934,0.6787,0,0,0,0,
			0.7577,0.7431,0.3922,0.6555,0.1712,0,0,0,0 };
		const double Q_ld[]{
			-0.6207938622228, -0.154560758796689,0.479344322039396, -0.321468254294596, 0.500625274984451, 0.0835910815985244,0,0,
			-0.07429409790932, -0.17707859766604, -0.287176127497771, -0.79778986158619, -0.321450823922257, -0.37530538713139,0,0,
			-0.120089741851373, -0.771426698803364, -0.254652968468967, 0.386622567240651, 0.169145687493211, -0.384114429341121,0,0,
			-0.108126487111103, -0.273077416783337, -0.506838341291211, -0.139647719197317, 0.0441331940078665, 0.797121733949575,0,0,
			-0.499637333324524,   0.521984537055711, -0.580180031408702, 0.157727038950421, 0.239035801052366, -0.243454053933954,0,0,
			-0.57736038959889, -0.0511454590343965, 0.171513222014195, 0.257552294569938, -0.747226595652759, 0.0997074095924538,0,0 };
		const double R_ld[]{
			-1.31235189259588, -1.19204640068418, -0.984116392323211, -1.62724008099373, -1.10207955515584,0,
			0, -1.07261967566136, -0.681782306693105, -0.447503294312055, -0.80248312849391,0,
			0,0, -1.22940896476355, -0.79172515549949, -1.02847417900777,0,
			0,0,0, -0.664332641480675, -0.646519613301525,0,
			0,0,0,0,0.218449022247435,0,
			0,0,0,0,0,0 };
		const double U_ld[]{
			-1.31235189259588, -1.19204640068418, -0.984116392323211, -1.62724008099373,-1.10207955515584,0,0,
			0.0458380918394095, -1.07261967566136, -0.681782306693105, -0.447503294312055,-0.802483128493911,0,0,
			0.0740931617834968,0.64955454096634, -1.22940896476355, -0.79172515549949,-1.02847417900777,0,0,
			0.0667120536616637,0.224587809775278,0.43088167987985, -0.664332641480675,-0.646519613301525,0,0,
			0.30826704429847, -0.486866265436373,0.806399797389196,0.64673735967616,0.218449022247434,0,0,
			0.356220740376622, -0.00334385430562029,0.000250527139268941, -0.275874736646322,0.711610030647557,0,0 };
		const double tau_ld[]{
			-1.6207938622228,0,
			-1.16999382740955,0,
			-1.08936038603983,0,
			-1.33835118423397,0,
			-1.32767845364868,0,
			0,0 };
		const double b_ld[]{
			0.5060,0.1493,0,0,
			0.6991,0.2575,0,0,
			0.8909,0.8407,0,0,
			0.9593,0.2543,0,0,
			0.5472,0.8143,0,0,
			0.1386,0.2435,0,0
		};
		const double x_ld[]{
			0.209748905164346, 0.947708395923203,0,
			0.072279163615098, -0.200871645791878,0,
			0.169848963487236, 0.699653165641312,0,
			-0.524722596591983, -1.04635860123482,0,
			1.13918462877824,0.723696504731286,0,
		};

		double result_Q[m*m], result_R[m*n], result_U[m*n], result_tau[std::max(m, n)], result_x[std::max(m, n)*rhs];
		double result_Q_ld[m*q_t], result_R_ld[m*r_t], result_U_ld[m*u_t], result_tau_ld[n*tau_t], result_x_ld[std::max(m, n)*x_t];

		s_householder_ut(m, n, A, result_U, result_tau);
		if (!(s_is_equal(m, n, result_U, U, error) && s_is_equal(std::min(m - 1, n), result_tau, tau, error)))std::cout << "\"s_householder\" failed" << std::endl;

		s_householder_ut(m, n, A_ld, a_t, result_U_ld, u_t, result_tau_ld, tau_t);
		if (!(s_is_equal(m, n, result_U_ld, u_t, U_ld, u_t, error) && s_is_equal(std::min(m - 1, n), 1, result_tau_ld, tau_t, tau_ld, tau_t, error)))std::cout << "\"s_householder_ut\" failed" << std::endl;

		s_householder_ut2qr(m, n, U, tau, result_Q, result_R);
		if (!(s_is_equal(m, m, result_Q, Q, error) && s_is_equal(m, n, result_R, R, error)))std::cout << "\"s_householder_ut2qr\" failed" << std::endl;

		s_householder_ut2qr(m, n, U_ld, u_t, tau_ld, tau_t, result_Q_ld, q_t, result_R_ld, r_t);
		if (!(s_is_equal(m, m, result_Q_ld, q_t, Q_ld, q_t, error) && s_is_equal(m, n, result_R_ld, r_t, R_ld, r_t, error)))std::cout << "\"s_householder_ut2qr\" failed" << std::endl;

		s_householder_ut_sov(m, n, rhs, U, tau, b, result_x);
		if (!(s_is_equal(n, rhs, result_x, x, error)))std::cout << "\"s_householder_ut_sov\" failed" << std::endl;

		s_householder_ut_sov(m, n, rhs, U_ld, u_t, tau_ld, tau_t, b_ld, b_t, result_x_ld, x_t);
		if (!(s_is_equal(n, rhs, result_x_ld, x_t, x_ld, x_t, error)))std::cout << "\"s_householder_ut_sov\" failed" << std::endl;
	}
}



void test_matrix()
{
	std::cout << std::endl << "-----------------test matrix--------------------" << std::endl;

	test_basic_operation();
	test_multiply();
	test_llt();
	test_householder();
	

	std::cout << "-----------------test matrix finished-----------" << std::endl << std::endl;
}